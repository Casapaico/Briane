---
import { mainNavigation } from '../../data/navigation';
---

<div class="mobile-menu-overlay" id="mobile-menu-overlay"></div>

<nav class="mobile-menu" id="mobile-menu" aria-label="Menu movil">
  <ul class="mobile-nav-list">
    {
      mainNavigation.map((item, index) => (
        <li class={`mobile-nav-item ${item.children ? 'has-children' : ''}`}>
          {item.children ? (
            <>
              <button
                class="mobile-nav-link mobile-dropdown-toggle"
                aria-expanded="false"
                data-dropdown={index}
              >
                {item.label}
                <svg
                  class="mobile-dropdown-arrow"
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <polyline points="6 9 12 15 18 9" />
                </svg>
              </button>
              <ul class="mobile-dropdown" data-dropdown-content={index}>
                {item.children.map((child) => (
                  <li>
                    <a href={child.href} class="mobile-dropdown-link">
                      {child.label}
                    </a>
                  </li>
                ))}
              </ul>
            </>
          ) : (
            <a href={item.href} class="mobile-nav-link">
              {item.label}
            </a>
          )}
        </li>
      ))
    }
  </ul>

  <div class="mobile-menu-footer">
    <p>Contactenos</p>
    <a href="tel:+5112345678" class="mobile-phone">+51 1 234 5678</a>
    <a href="mailto:info@briane.pe" class="mobile-email">info@briane.pe</a>
  </div>
</nav>

<style>
  .mobile-menu-overlay {
    position: fixed;
    inset: 0;
    background-color: rgba(0, 0, 0, 0.5);
    opacity: 0;
    visibility: hidden;
    transition: opacity var(--transition-base), visibility var(--transition-base);
    z-index: var(--z-modal-backdrop);
  }

  .mobile-menu.open ~ .mobile-menu-overlay,
  .mobile-menu-overlay.open {
    opacity: 1;
    visibility: visible;
  }

  .mobile-menu {
    position: fixed;
    top: 0;
    right: 0;
    width: 100%;
    max-width: 320px;
    height: 100vh;
    background-color: var(--color-white);
    transform: translateX(100%);
    transition: transform var(--transition-base);
    z-index: var(--z-modal);
    overflow-y: auto;
    padding: calc(var(--header-height) + var(--spacing-md)) var(--spacing-md)
      var(--spacing-md);
    display: flex;
    flex-direction: column;
  }

  .mobile-menu.open {
    transform: translateX(0);
  }

  @media (min-width: 1024px) {
    .mobile-menu,
    .mobile-menu-overlay {
      display: none;
    }
  }

  .mobile-nav-list {
    flex: 1;
  }

  .mobile-nav-item {
    border-bottom: 1px solid var(--color-gray-100);
  }

  .mobile-nav-link {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    padding: var(--spacing-md);
    color: var(--color-gray-800);
    font-weight: var(--font-medium);
    font-size: var(--text-base);
    text-align: left;
    background: none;
    border: none;
    cursor: pointer;
    transition: background-color var(--transition-fast);
  }

  .mobile-nav-link:hover {
    background-color: var(--color-gray-50);
    color: var(--color-primary);
  }

  .mobile-dropdown-arrow {
    transition: transform var(--transition-fast);
  }

  .mobile-dropdown-toggle[aria-expanded='true'] .mobile-dropdown-arrow {
    transform: rotate(180deg);
  }

  .mobile-dropdown {
    display: none;
    padding-left: var(--spacing-md);
    background-color: var(--color-gray-50);
  }

  .mobile-dropdown.open {
    display: block;
  }

  .mobile-dropdown-link {
    display: block;
    padding: var(--spacing-sm) var(--spacing-md);
    color: var(--color-gray-600);
    font-size: var(--text-sm);
    transition: color var(--transition-fast);
  }

  .mobile-dropdown-link:hover {
    color: var(--color-primary);
  }

  .mobile-menu-footer {
    padding-top: var(--spacing-lg);
    border-top: 1px solid var(--color-gray-200);
    margin-top: var(--spacing-lg);
  }

  .mobile-menu-footer p {
    font-size: var(--text-sm);
    color: var(--color-gray-500);
    margin-bottom: var(--spacing-sm);
  }

  .mobile-phone,
  .mobile-email {
    display: block;
    color: var(--color-gray-800);
    font-weight: var(--font-medium);
    margin-bottom: var(--spacing-xs);
  }

  .mobile-phone:hover,
  .mobile-email:hover {
    color: var(--color-primary);
  }
</style>

<script>
  // Mobile dropdown toggles
  const dropdownToggles = document.querySelectorAll('.mobile-dropdown-toggle');
  const mobileMenu = document.getElementById('mobile-menu');
  const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');
  const mobileMenuToggle = document.getElementById('mobile-menu-toggle');

  dropdownToggles.forEach((toggle) => {
    toggle.addEventListener('click', () => {
      const expanded = toggle.getAttribute('aria-expanded') === 'true';
      const dropdownIndex = toggle.getAttribute('data-dropdown');
      const dropdown = document.querySelector(
        `[data-dropdown-content="${dropdownIndex}"]`
      );

      toggle.setAttribute('aria-expanded', String(!expanded));
      dropdown?.classList.toggle('open');
    });
  });

  // Close menu when clicking overlay
  mobileMenuOverlay?.addEventListener('click', () => {
    mobileMenu?.classList.remove('open');
    mobileMenuOverlay.classList.remove('open');
    mobileMenuToggle?.setAttribute('aria-expanded', 'false');
    document.body.classList.remove('menu-open');
  });

  // Update overlay state when menu opens
  const observer = new MutationObserver((mutations) => {
    mutations.forEach((mutation) => {
      if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
        const target = mutation.target as HTMLElement;
        if (target.classList.contains('open')) {
          mobileMenuOverlay?.classList.add('open');
        } else {
          mobileMenuOverlay?.classList.remove('open');
        }
      }
    });
  });

  if (mobileMenu) {
    observer.observe(mobileMenu, { attributes: true });
  }
</script>

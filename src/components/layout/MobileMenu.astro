---
import { mainNavigation } from '../../data/navigation';
---

<div class="mobile-menu-overlay" id="mobile-menu-overlay"></div>

<nav class="mobile-menu" id="mobile-menu" aria-label="Menu movil">
  <!-- Logo Header -->
  <div class="mobile-menu-header">
    <a href="/" class="mobile-logo">
      <img src="/images/logo/logo-briane.png" alt="BRIANE" />
    </a>
  </div>

  <ul class="mobile-nav-list">
    {
      mainNavigation.map((item, index) => (
        <li class={`mobile-nav-item ${item.children ? 'has-children' : ''}`}>
          {item.children ? (
            <>
              <button
                class="mobile-nav-link mobile-dropdown-toggle"
                aria-expanded="false"
                data-dropdown={index}
              >
                {item.label}
                <svg
                  class="mobile-dropdown-arrow"
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <polyline points="6 9 12 15 18 9" />
                </svg>
              </button>
              <ul class="mobile-dropdown" data-dropdown-content={index}>
                {item.children.map((child) => (
                  <li>
                    <a href={child.href} class="mobile-dropdown-link">
                      {child.label}
                    </a>
                  </li>
                ))}
              </ul>
            </>
          ) : (
            <a href={item.href} class="mobile-nav-link">
              {item.label}
            </a>
          )}
        </li>
      ))
    }
  </ul>

  <div class="mobile-menu-footer">
    <p class="mobile-footer-title">Cont√°ctenos</p>
    <a href="tel:+51998109252" class="mobile-contact-link">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.127.96.361 1.903.7 2.81a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0 1 22 16.92z"></path>
      </svg>
      <span>+51 998 109 252</span>
    </a>
    <a href="mailto:alvaro.villabos@supervan.pe" class="mobile-contact-link">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
        <polyline points="22,6 12,13 2,6"></polyline>
      </svg>
      <span>alvaro.villabos@supervan.pe</span>
    </a>
  </div>
</nav>

<style>
  .mobile-menu-overlay {
    position: fixed;
    inset: 0;
    background-color: rgba(0, 0, 0, 0.6);
    opacity: 0;
    visibility: hidden;
    transition: opacity var(--transition-base), visibility var(--transition-base);
    z-index: var(--z-modal-backdrop);
    backdrop-filter: blur(4px);
  }

  .mobile-menu.open ~ .mobile-menu-overlay,
  .mobile-menu-overlay.open {
    opacity: 1;
    visibility: visible;
  }

  .mobile-menu {
    position: fixed;
    top: 0;
    right: 0;
    width: 85%;
    max-width: 340px;
    height: 100vh;
    background: linear-gradient(180deg, #1a1a1a 0%, #2d2d2d 100%);
    transform: translateX(100%);
    transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: var(--z-modal);
    overflow-y: auto;
    padding: 0;
    display: flex;
    flex-direction: column;
  }

  .mobile-menu.open {
    transform: translateX(0);
  }

  @media (min-width: 1024px) {
    .mobile-menu,
    .mobile-menu-overlay {
      display: none;
    }
  }

  /* Logo Header */
  .mobile-menu-header {
    padding: var(--spacing-xl) var(--spacing-lg);
    background: linear-gradient(135deg, var(--color-secondary) 0%, #e3a815 100%);
    display: flex;
    align-items: center;
    justify-content: flex-start;
  }

  .mobile-logo img {
    height: 60px;
    width: auto;
    object-fit: contain;
    filter: none;
  }

  /* Navigation List */
  .mobile-nav-list {
    flex: 1;
    padding: var(--spacing-sm) 0;
  }

  .mobile-nav-item {
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
  }

  .mobile-nav-link {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    padding: var(--spacing-md) var(--spacing-lg);
    color: rgba(255, 255, 255, 0.9);
    font-weight: var(--font-medium);
    font-size: var(--text-base);
    text-align: left;
    background: none;
    border: none;
    cursor: pointer;
    transition: all 0.2s ease;
    letter-spacing: 0.02em;
  }

  .mobile-nav-link:hover {
    background-color: rgba(255, 255, 255, 0.08);
    color: var(--color-secondary);
    padding-left: calc(var(--spacing-lg) + 4px);
  }

  .mobile-dropdown-arrow {
    transition: transform var(--transition-fast);
    color: rgba(255, 255, 255, 0.5);
  }

  .mobile-dropdown-toggle[aria-expanded='true'] .mobile-dropdown-arrow {
    transform: rotate(180deg);
    color: var(--color-secondary);
  }

  .mobile-dropdown {
    display: none;
    padding-left: var(--spacing-md);
    background-color: rgba(0, 0, 0, 0.2);
  }

  .mobile-dropdown.open {
    display: block;
  }

  .mobile-dropdown-link {
    display: block;
    padding: var(--spacing-sm) var(--spacing-lg);
    color: rgba(255, 255, 255, 0.7);
    font-size: var(--text-sm);
    transition: all 0.2s ease;
  }

  .mobile-dropdown-link:hover {
    color: var(--color-secondary);
    padding-left: calc(var(--spacing-lg) + 4px);
  }

  /* Footer */
  .mobile-menu-footer {
    padding: var(--spacing-lg);
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    background: rgba(0, 0, 0, 0.15);
  }

  .mobile-footer-title {
    font-size: var(--text-xs);
    font-weight: var(--font-bold);
    color: var(--color-secondary);
    text-transform: uppercase;
    letter-spacing: 0.15em;
    margin-bottom: var(--spacing-md);
  }

  .mobile-contact-link {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-sm) 0;
    color: rgba(255, 255, 255, 0.8);
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
    transition: color 0.2s ease;
  }

  .mobile-contact-link:hover {
    color: var(--color-secondary);
  }

  .mobile-contact-link svg {
    color: var(--color-primary);
    flex-shrink: 0;
  }
</style>

<script>
  // Mobile dropdown toggles
  const dropdownToggles = document.querySelectorAll('.mobile-dropdown-toggle');
  const mobileMenu = document.getElementById('mobile-menu');
  const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');
  const mobileMenuToggle = document.getElementById('mobile-menu-toggle');

  dropdownToggles.forEach((toggle) => {
    toggle.addEventListener('click', () => {
      const expanded = toggle.getAttribute('aria-expanded') === 'true';
      const dropdownIndex = toggle.getAttribute('data-dropdown');
      const dropdown = document.querySelector(
        `[data-dropdown-content="${dropdownIndex}"]`
      );

      toggle.setAttribute('aria-expanded', String(!expanded));
      dropdown?.classList.toggle('open');
    });
  });

  // Close menu when clicking overlay
  mobileMenuOverlay?.addEventListener('click', () => {
    mobileMenu?.classList.remove('open');
    mobileMenuOverlay.classList.remove('open');
    mobileMenuToggle?.setAttribute('aria-expanded', 'false');
    document.body.classList.remove('menu-open');
  });

  // Update overlay state when menu opens
  const observer = new MutationObserver((mutations) => {
    mutations.forEach((mutation) => {
      if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
        const target = mutation.target as HTMLElement;
        if (target.classList.contains('open')) {
          mobileMenuOverlay?.classList.add('open');
        } else {
          mobileMenuOverlay?.classList.remove('open');
        }
      }
    });
  });

  if (mobileMenu) {
    observer.observe(mobileMenu, { attributes: true });
  }
</script>

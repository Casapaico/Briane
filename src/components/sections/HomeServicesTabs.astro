---
const supervanServices = [
  {
    icon: 'sil',
    title: 'Servicio Integrado de Logística (SIL)',
    description: 'Gestión logística integral de principio a fin',
    href: '/servicios/supervan#sil',
  },
  {
    icon: 'almacenaje',
    title: 'Almacenaje',
    description: 'Intemperie, Techado, Cámaras, Silos graneleros, Materiales peligrosos',
    href: '/servicios/almacenes',
  },
  {
    icon: 'distribucion',
    title: 'Distribución',
    description: 'Seco, Líquido, Refrigerado',
    href: '/servicios/supervan#distribucion',
  },
  {
    icon: 'transporte',
    title: 'Transporte',
    description: 'Terrestre, Fluvial, Aereo, Multimodal',
    href: '/servicios/supervan',
  },
  {
    icon: 'inhouse',
    title: 'In House Management',
    description: 'Servicio logístico integral y servicios complementarios',
    href: '/servicios/supervan#inhouse',
  },
  {
    icon: 'aduanero',
    title: 'Agenciamiento Aduanero',
    description: 'Operaciones de comercio exterior',
    href: '/servicios/supervan#aduanero',
  },
  {
    icon: 'temporal',
    title: 'Depósito Temporal',
    description: 'Importación, Exportación, Contenedores Vacíos, Depósito Simple',
    href: '/servicios/almacenes#temporal',
  },
  {
    icon: 'valor',
    title: 'Servicio de Valor Agregado',
    description: 'Maquilla, Inspección de Pre Envío (PDI)',
    href: '/valor-agregado',
  },
  {
    icon: 'ultimamilla',
    title: 'Última Milla',
    description: 'Tramo de la última milla en la distribución',
    href: '/servicios/supervan#ultimamilla',
  },
];

const almacenesServices = [
  {
    icon: 'almacen-general',
    title: 'Almacén General',
    description: 'Espacios amplios para mercadería sin requerimientos especiales',
    href: '/servicios/almacenes#general',
  },
  {
    icon: 'climatizado',
    title: 'Almacén Climatizado',
    description: 'Control de temperatura para productos sensibles',
    href: '/servicios/almacenes#climatizado',
  },
  {
    icon: 'seguridad',
    title: 'Alta Seguridad',
    description: 'Máxima protección para mercadería de alto valor',
    href: '/servicios/almacenes#seguridad',
  },
  {
    icon: 'wms',
    title: 'Sistema WMS',
    description: 'Gestión de almacén con tecnología de punta',
    href: '/servicios/almacenes#wms',
  },
  {
    icon: 'picking',
    title: 'Picking y Packing',
    description: 'Preparación de pedidos según especificaciones',
    href: '/servicios/almacenes#picking',
  },
  {
    icon: 'crossdocking',
    title: 'Cross-Docking',
    description: 'Consolidación y deconsolidación de cargas',
    href: '/servicios/almacenes#crossdocking',
  },
  {
    icon: 'inventario',
    title: 'Control de Inventario',
    description: 'Monitoreo en tiempo real de existencias',
    href: '/servicios/almacenes#inventario',
  },
  {
    icon: 'devoluciones',
    title: 'Gestión de Devoluciones',
    description: 'Logística inversa eficiente',
    href: '/servicios/almacenes#devoluciones',
  },
  {
    icon: 'temporal-alm',
    title: 'Almacén Temporal',
    description: 'Soluciones flexibles para necesidades estacionales',
    href: '/servicios/almacenes#temporal',
  },
];

// SVG paths for icons
const iconPaths: Record<string, string> = {
  'sil': 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67V7z',
  'almacenaje': 'M12 3L2 9v11c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V9l-10-6zm6 16h-4v-5h-4v5H6v-9l6-3.6 6 3.6v9z',
  'distribucion': 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z',
  'transporte': 'M18 18.5c.83 0 1.5-.67 1.5-1.5s-.67-1.5-1.5-1.5-1.5.67-1.5 1.5.67 1.5 1.5 1.5zm1.5-9H17V12h4.46L19.5 9.5zM6 18.5c.83 0 1.5-.67 1.5-1.5s-.67-1.5-1.5-1.5-1.5.67-1.5 1.5.67 1.5 1.5 1.5zM20 8l3 4v5h-2c0 1.66-1.34 3-3 3s-3-1.34-3-3H9c0 1.66-1.34 3-3 3s-3-1.34-3-3H1V6c0-1.11.89-2 2-2h14v4h3zM3 6v9h.76c.55-.61 1.35-1 2.24-1s1.69.39 2.24 1H15V6H3z',
  'inhouse': 'M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z',
  'aduanero': 'M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z',
  'temporal': 'M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM9 10H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2z',
  'valor': 'M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z',
  'ultimamilla': 'M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z',
  'almacen-general': 'M12 3L2 9v11c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V9l-10-6zm6 16h-4v-5h-4v5H6v-9l6-3.6 6 3.6v9z',
  'climatizado': 'M15 13V5c0-1.66-1.34-3-3-3S9 3.34 9 5v8c-1.21.91-2 2.37-2 4 0 2.76 2.24 5 5 5s5-2.24 5-5c0-1.63-.79-3.09-2-4zm-4-8c0-.55.45-1 1-1s1 .45 1 1h-1v1h1v2h-1v1h1v2h-2V5z',
  'seguridad': 'M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z',
  'wms': 'M21 2H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h7v2H8v2h8v-2h-2v-2h7c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H3V4h18v12z',
  'picking': 'M21 16.5c0 .38-.21.71-.53.88l-7.9 4.44c-.16.12-.36.18-.57.18-.21 0-.41-.06-.57-.18l-7.9-4.44c-.32-.17-.53-.5-.53-.88v-9c0-.38.21-.71.53-.88l7.9-4.44c.16-.12.36-.18.57-.18.21 0 .41.06.57.18l7.9 4.44c.32.17.53.5.53.88v9zM12 4.15L6.04 7.5 12 10.85l5.96-3.35L12 4.15zM5 15.91l6 3.38v-6.71L5 9.21v6.7zm14 0v-6.7l-6 3.37v6.71l6-3.38z',
  'crossdocking': 'M6.99 11L3 15l3.99 4v-3H14v-2H6.99v-3zM21 9l-3.99-4v3H10v2h7.01v3L21 9z',
  'inventario': 'M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z',
  'devoluciones': 'M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z',
  'temporal-alm': 'M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67V7z',
};
---

<section class="home-services-tabs section">
  <div class="parallax-bg" aria-hidden="true">
    <img src="/images/transporte/transporte-en-puerto1.jpeg" alt="" loading="lazy" />
    <div class="parallax-overlay"></div>
  </div>
  <div class="container">
    <div class="section-header text-center animate-on-scroll">
      <h2>Nuestros Servicios</h2>
      <p class="section-subtitle">Soluciones logísticas integrales para su empresa</p>
    </div>

    <div class="tabs-wrapper" data-default-tab="supervan">
      <div class="tabs-header" role="tablist" aria-label="Categorías de servicios">
        <button
          role="tab"
          id="home-tab-supervan"
          aria-controls="home-panel-supervan"
          aria-selected="true"
          class="tab-button active"
          tabindex="0"
          data-tab="supervan"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d={iconPaths['transporte']} />
          </svg>
          <span>SUPERVAN</span>
        </button>
        <button
          role="tab"
          id="home-tab-almacenes"
          aria-controls="home-panel-almacenes"
          aria-selected="false"
          class="tab-button"
          tabindex="-1"
          data-tab="almacenes"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d={iconPaths['almacenaje']} />
          </svg>
          <span>ALMACENES DIEF</span>
        </button>
        <div class="tab-indicator" aria-hidden="true"></div>
      </div>

      <div class="tabs-content">
        <!-- SUPERVAN Panel -->
        <div
          role="tabpanel"
          id="home-panel-supervan"
          aria-labelledby="home-tab-supervan"
          class="tab-panel active"
          tabindex="0"
        >
          <div class="services-grid">
            {supervanServices.map((service, index) => (
              <a href={service.href} class="service-card animate-on-scroll" style={`--delay: ${index * 0.1}s`}>
                <div class="service-icon-wrapper">
                  <div class="icon-normal">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                      <path d={iconPaths[service.icon]} />
                    </svg>
                  </div>
                  <div class="icon-hover">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                      <path d={iconPaths[service.icon]} />
                    </svg>
                  </div>
                </div>
                <div class="service-content">
                  <h3>{service.title}</h3>
                  <p>{service.description}</p>
                </div>
                <div class="service-arrow">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M5 12h14M12 5l7 7-7 7"/>
                  </svg>
                </div>
              </a>
            ))}
          </div>
        </div>

        <!-- ALMACENES Panel -->
        <div
          role="tabpanel"
          id="home-panel-almacenes"
          aria-labelledby="home-tab-almacenes"
          class="tab-panel"
          aria-hidden="true"
          tabindex="0"
        >
          <div class="services-grid">
            {almacenesServices.map((service, index) => (
              <a href={service.href} class="service-card animate-on-scroll" style={`--delay: ${index * 0.1}s`}>
                <div class="service-icon-wrapper">
                  <div class="icon-normal">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                      <path d={iconPaths[service.icon]} />
                    </svg>
                  </div>
                  <div class="icon-hover">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                      <path d={iconPaths[service.icon]} />
                    </svg>
                  </div>
                </div>
                <div class="service-content">
                  <h3>{service.title}</h3>
                  <p>{service.description}</p>
                </div>
                <div class="service-arrow">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M5 12h14M12 5l7 7-7 7"/>
                  </svg>
                </div>
              </a>
            ))}
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .home-services-tabs {
    position: relative;
    padding: var(--spacing-4xl) 0;
    background-color: var(--color-gray-900);
    overflow: hidden;
  }

  /* Parallax Background */
  .parallax-bg {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 0;
  }

  .parallax-bg img {
    position: absolute;
    top: -10%;
    left: 0;
    width: 100%;
    height: 120%;
    object-fit: cover;
    object-position: center;
    will-change: transform;
    transition: transform 0.1s linear;
  }

  .parallax-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(
      180deg,
      rgba(26, 26, 26, 0.85) 0%,
      rgba(26, 26, 26, 0.75) 30%,
      rgba(227, 39, 29, 0.15) 70%,
      rgba(26, 26, 26, 0.9) 100%
    );
  }

  .home-services-tabs .container {
    position: relative;
    z-index: 1;
  }

  .section-header {
    margin-bottom: var(--spacing-3xl);
  }

  .section-header h2 {
    font-size: var(--text-4xl);
    margin-bottom: var(--spacing-sm);
    color: var(--color-white);
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
  }

  .section-subtitle {
    font-size: var(--text-lg);
    color: rgba(255, 255, 255, 0.85);
    max-width: 600px;
    margin: 0 auto;
  }

  .tabs-wrapper {
    max-width: 1200px;
    margin: 0 auto;
  }

  .tabs-header {
    display: flex;
    position: relative;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 0;
    padding: var(--spacing-xs);
    gap: var(--spacing-xs);
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    margin-bottom: var(--spacing-2xl);
    max-width: 500px;
    margin-left: auto;
    margin-right: auto;
  }

  .tab-button {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-md) var(--spacing-lg);
    font-size: var(--text-base);
    font-weight: var(--font-bold);
    letter-spacing: 0.05em;
    color: var(--color-gray-700);
    background: transparent;
    border: none;
    border-radius: 0;
    cursor: pointer;
    transition: all var(--transition-base);
    position: relative;
    z-index: 1;
  }

  .tab-button:hover {
    color: var(--color-primary);
  }

  .tab-button.active {
    color: var(--color-white);
  }

  .tab-button svg {
    width: 24px;
    height: 24px;
  }

  .tab-indicator {
    position: absolute;
    top: var(--spacing-xs);
    left: var(--spacing-xs);
    height: calc(100% - var(--spacing-sm));
    width: calc(50% - var(--spacing-xs));
    background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 100%);
    border-radius: 0;
    transition: transform var(--transition-base);
    z-index: 0;
    box-shadow: 0 4px 15px rgba(227, 39, 29, 0.4);
  }

  .tab-panel {
    display: none;
  }

  .tab-panel.active {
    display: block;
    animation: panelFadeIn 0.5s ease-out;
  }

  @keyframes panelFadeIn {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .services-grid {
    display: grid;
    grid-template-columns: repeat(1, 1fr);
    gap: var(--spacing-lg);
  }

  @media (min-width: 640px) {
    .services-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (min-width: 1024px) {
    .services-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  /* Service Card - Estilo Corporativo Premium */
  .service-card {
    display: flex;
    align-items: center;
    gap: var(--spacing-lg);
    padding: var(--spacing-xl);
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 0;
    text-decoration: none;
    position: relative;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    border-left: 4px solid transparent;
  }

  .service-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: -4px;
    width: 4px;
    height: 100%;
    background: linear-gradient(180deg, var(--color-secondary) 0%, var(--color-primary) 100%);
    transform: scaleY(0);
    transform-origin: bottom;
    transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }

  .service-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
    background: var(--color-white);
  }

  .service-card:hover::before {
    transform: scaleY(1);
  }

  /* Icon wrapper con efecto dual */
  .service-icon-wrapper {
    position: relative;
    width: 72px;
    height: 72px;
    flex-shrink: 0;
  }

  .icon-normal,
  .icon-hover {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }

  .icon-normal {
    color: var(--color-primary);
    opacity: 1;
    transform: scale(1);
  }

  .icon-hover {
    color: var(--color-white);
    background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 100%);
    border-radius: 50%;
    opacity: 0;
    transform: scale(0.8);
  }

  .service-card:hover .icon-normal {
    opacity: 0;
    transform: scale(0.8);
  }

  .service-card:hover .icon-hover {
    opacity: 1;
    transform: scale(1);
  }

  .service-icon-wrapper svg {
    width: 40px;
    height: 40px;
  }

  /* Content */
  .service-content {
    flex: 1;
    min-width: 0;
  }

  .service-content h3 {
    font-size: var(--text-base);
    font-weight: var(--font-bold);
    color: var(--color-gray-900);
    margin-bottom: var(--spacing-xs);
    line-height: 1.3;
    transition: color var(--transition-base);
  }

  .service-card:hover .service-content h3 {
    color: var(--color-primary);
  }

  .service-content p {
    font-size: var(--text-sm);
    color: var(--color-gray-600);
    line-height: 1.5;
    margin: 0;
  }

  /* Arrow indicator */
  .service-arrow {
    position: absolute;
    right: var(--spacing-lg);
    top: 50%;
    transform: translateY(-50%) translateX(10px);
    opacity: 0;
    color: var(--color-primary);
    transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }

  .service-card:hover .service-arrow {
    opacity: 1;
    transform: translateY(-50%) translateX(0);
  }

  /* Animate on scroll */
  .animate-on-scroll {
    opacity: 0;
    transform: translateY(30px);
    transition: opacity 0.6s ease-out, transform 0.6s ease-out;
    transition-delay: var(--delay, 0s);
  }

  .animate-on-scroll.animated {
    opacity: 1;
    transform: translateY(0);
  }

  @media (max-width: 640px) {
    .tab-button span {
      display: none;
    }

    .tab-button svg {
      width: 28px;
      height: 28px;
    }

    .service-card {
      flex-direction: column;
      text-align: center;
      padding: var(--spacing-lg);
    }

    .service-card::before {
      width: 100%;
      height: 4px;
      transform: scaleX(0);
      transform-origin: left;
    }

    .service-card:hover::before {
      transform: scaleX(1);
    }

    .service-icon-wrapper {
      margin: 0 auto;
    }

    .service-arrow {
      display: none;
    }
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .service-card,
    .icon-normal,
    .icon-hover,
    .service-arrow,
    .animate-on-scroll {
      transition: none;
    }

    .animate-on-scroll {
      opacity: 1;
      transform: none;
    }
  }
</style>

<script>
  const tabsWrapper = document.querySelector('.home-services-tabs .tabs-wrapper');
  const tabButtons = tabsWrapper?.querySelectorAll('.tab-button');
  const tabPanels = tabsWrapper?.querySelectorAll('.tab-panel');
  const tabIndicator = tabsWrapper?.querySelector('.tab-indicator') as HTMLElement;

  function updateIndicator(activeButton: HTMLElement) {
    if (!tabIndicator || !activeButton) return;
    const buttons = Array.from(tabButtons || []);
    const index = buttons.indexOf(activeButton);
    tabIndicator.style.transform = `translateX(${index * 100}%)`;
  }

  function switchTab(tabId: string) {
    tabButtons?.forEach((button) => {
      const isActive = button.getAttribute('data-tab') === tabId;
      button.classList.toggle('active', isActive);
      button.setAttribute('aria-selected', String(isActive));
      button.setAttribute('tabindex', isActive ? '0' : '-1');

      if (isActive) {
        updateIndicator(button as HTMLElement);
      }
    });

    tabPanels?.forEach((panel) => {
      const isActive = panel.id === `home-panel-${tabId}`;
      panel.classList.toggle('active', isActive);
      panel.setAttribute('aria-hidden', String(!isActive));

      // Re-trigger animations for newly active panel
      if (isActive) {
        const cards = panel.querySelectorAll('.animate-on-scroll');
        cards.forEach((card) => {
          card.classList.remove('animated');
          // Force reflow
          void (card as HTMLElement).offsetWidth;
          card.classList.add('animated');
        });
      }
    });
  }

  // Click handler
  tabButtons?.forEach((button) => {
    button.addEventListener('click', () => {
      const tabId = button.getAttribute('data-tab');
      if (tabId) switchTab(tabId);
    });
  });

  // Keyboard navigation
  tabButtons?.forEach((button) => {
    button.addEventListener('keydown', (e) => {
      const buttons = Array.from(tabButtons || []);
      const currentIndex = buttons.indexOf(button);
      let newIndex = currentIndex;

      if (e.key === 'ArrowRight') {
        newIndex = (currentIndex + 1) % buttons.length;
      } else if (e.key === 'ArrowLeft') {
        newIndex = (currentIndex - 1 + buttons.length) % buttons.length;
      } else if (e.key === 'Home') {
        newIndex = 0;
      } else if (e.key === 'End') {
        newIndex = buttons.length - 1;
      } else {
        return;
      }

      e.preventDefault();
      const newButton = buttons[newIndex] as HTMLElement;
      newButton.focus();
      const tabId = newButton.getAttribute('data-tab');
      if (tabId) switchTab(tabId);
    });
  });

  // Intersection Observer for scroll animations
  const observerOptions = {
    root: null,
    rootMargin: '0px 0px -50px 0px',
    threshold: 0.1
  };

  const animateOnScrollObserver = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        entry.target.classList.add('animated');
      }
    });
  }, observerOptions);

  // Observe all animate-on-scroll elements
  document.querySelectorAll('.home-services-tabs .animate-on-scroll').forEach((el) => {
    animateOnScrollObserver.observe(el);
  });

  // Initial animation for visible elements in active panel
  const activePanel = document.querySelector('.home-services-tabs .tab-panel.active');
  if (activePanel) {
    const visibleCards = activePanel.querySelectorAll('.animate-on-scroll');
    visibleCards.forEach((card) => {
      animateOnScrollObserver.observe(card);
    });
  }

  // Parallax scroll effect
  const parallaxSection = document.querySelector('.home-services-tabs');
  const parallaxBg = document.querySelector('.home-services-tabs .parallax-bg img') as HTMLElement;

  if (parallaxSection && parallaxBg) {
    const handleParallax = () => {
      const rect = parallaxSection.getBoundingClientRect();
      const windowHeight = window.innerHeight;

      // Check if section is in viewport
      if (rect.top < windowHeight && rect.bottom > 0) {
        const scrollProgress = (windowHeight - rect.top) / (windowHeight + rect.height);
        const translateY = (scrollProgress - 0.5) * 100; // -50 to 50 range
        parallaxBg.style.transform = `translateY(${translateY}px) scale(1.1)`;
      }
    };

    // Throttle scroll handler for performance
    let ticking = false;
    window.addEventListener('scroll', () => {
      if (!ticking) {
        window.requestAnimationFrame(() => {
          handleParallax();
          ticking = false;
        });
        ticking = true;
      }
    }, { passive: true });

    // Initial call
    handleParallax();
  }
</script>

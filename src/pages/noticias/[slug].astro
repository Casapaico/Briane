---
import PageLayout from '../../layouts/PageLayout.astro';

export async function getStaticPaths() {
  try {
    const res = await fetch('http://localhost:8000/api/news/?page_size=1000');
    if (!res.ok) return [];
    const data = await res.json();
    const articles: {
      slug: string;
      title: string;
      excerpt: string;
      content: string;
      date: string;
      category: string;
      image: string | null;
    }[] = data.results || [];

    return articles.map((article) => ({
      params: { slug: article.slug },
      props: { article },
    }));
  } catch {
    return [];
  }
}

interface Article {
  slug: string;
  title: string;
  excerpt: string;
  content: string;
  date: string;
  category: string;
  image: string | null;
}

interface Props {
  article: Article;
}

const { article } = Astro.props;

const imageUrl = article.image
  ? article.image.startsWith('http')
    ? article.image
    : `http://localhost:8000${article.image}`
  : null;

const formattedDate = new Date(article.date).toLocaleDateString('es-PE', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});
---

<PageLayout
  title={article.title}
  description={article.excerpt}
  heroTitle={article.title}
  heroSubtitle={article.category || 'Noticias BRIANE'}
>
  <article class="article-section section">
    <div class="container">
      <div class="article-wrapper">

        <!-- Meta info -->
        <div class="article-meta reveal">
          <nav class="article-breadcrumb" aria-label="Ruta">
            <a href="/noticias">← Volver a Noticias</a>
          </nav>
          <div class="article-info">
            {article.category && (
              <span class="article-category">{article.category}</span>
            )}
            <time class="article-date" datetime={article.date}>
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
              </svg>
              {formattedDate}
            </time>
          </div>
        </div>

        <!-- Imagen destacada -->
        {imageUrl && (
          <div class="article-image reveal">
            <img
              src={imageUrl}
              alt={article.title}
              loading="eager"
            />
          </div>
        )}

        <!-- Contenido -->
        <div class="article-content reveal">
          <p class="article-excerpt">{article.excerpt}</p>
          <div class="article-body" set:html={article.content}></div>
        </div>

        <!-- Pie del artículo -->
        <div class="article-footer reveal">
          <a href="/noticias" class="btn btn-outline">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="19" y1="12" x2="5" y2="12"></line>
              <polyline points="12 19 5 12 12 5"></polyline>
            </svg>
            Ver más noticias
          </a>
        </div>

      </div>
    </div>
  </article>
</PageLayout>

<style>
  .article-section {
    background-color: var(--color-white);
  }

  .article-wrapper {
    max-width: 860px;
    margin: 0 auto;
  }

  .article-meta {
    margin-bottom: var(--spacing-xl);
  }

  .article-breadcrumb {
    margin-bottom: var(--spacing-md);
  }

  .article-breadcrumb a {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-xs);
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
    color: var(--color-primary);
    text-decoration: none;
    transition: color var(--transition-fast);
  }

  .article-breadcrumb a:hover {
    color: var(--color-primary-dark);
  }

  .article-info {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    flex-wrap: wrap;
  }

  .article-category {
    display: inline-block;
    padding: var(--spacing-xs) var(--spacing-md);
    background-color: var(--color-primary);
    color: var(--color-white);
    font-size: var(--text-xs);
    font-weight: var(--font-semibold);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    border-radius: var(--radius-sm);
  }

  .article-date {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    font-size: var(--text-sm);
    color: var(--color-gray-500);
  }

  .article-image {
    margin-bottom: var(--spacing-2xl);
    border-radius: var(--radius-image);
    overflow: hidden;
    aspect-ratio: 16/9;
  }

  .article-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .article-content {
    margin-bottom: var(--spacing-2xl);
  }

  .article-excerpt {
    font-size: var(--text-xl);
    font-weight: var(--font-medium);
    color: var(--color-gray-700);
    line-height: 1.7;
    margin-bottom: var(--spacing-xl);
    padding-bottom: var(--spacing-xl);
    border-bottom: 2px solid var(--color-gray-100);
  }

  .article-body {
    font-size: var(--text-lg);
    color: var(--color-gray-700);
    line-height: 1.9;
  }

  .article-body :global(h2),
  .article-body :global(h3),
  .article-body :global(h4) {
    color: var(--color-gray-900);
    margin-top: var(--spacing-2xl);
    margin-bottom: var(--spacing-md);
    font-weight: var(--font-bold);
  }

  .article-body :global(h2) {
    font-size: var(--text-2xl);
  }

  .article-body :global(h3) {
    font-size: var(--text-xl);
  }

  .article-body :global(p) {
    margin-bottom: var(--spacing-lg);
  }

  .article-body :global(ul),
  .article-body :global(ol) {
    padding-left: var(--spacing-xl);
    margin-bottom: var(--spacing-lg);
  }

  .article-body :global(li) {
    margin-bottom: var(--spacing-sm);
  }

  .article-body :global(img) {
    max-width: 100%;
    height: auto;
    border-radius: var(--radius-card);
    margin: var(--spacing-xl) 0;
  }

  .article-body :global(a) {
    color: var(--color-primary);
    text-decoration: underline;
  }

  .article-body :global(blockquote) {
    border-left: 4px solid var(--color-primary);
    padding-left: var(--spacing-xl);
    margin: var(--spacing-xl) 0;
    color: var(--color-gray-600);
    font-style: italic;
  }

  .article-footer {
    padding-top: var(--spacing-xl);
    border-top: 1px solid var(--color-gray-200);
  }

  .btn {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-sm) var(--spacing-xl);
    font-size: var(--text-base);
    font-weight: var(--font-semibold);
    border-radius: var(--radius-md);
    text-decoration: none;
    cursor: pointer;
    transition: all var(--transition-fast);
    font-family: var(--font-primary);
    border: 2px solid transparent;
  }

  .btn-outline {
    color: var(--color-primary);
    border-color: var(--color-primary);
    background-color: transparent;
  }

  .btn-outline:hover {
    background-color: var(--color-primary);
    color: var(--color-white);
  }
</style>
